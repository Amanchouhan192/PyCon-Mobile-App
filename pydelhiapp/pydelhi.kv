#:import Animation kivy.animation.Animation
#:import webbrowser webbrowser
#:set active_text_color 59./256., 205./256., 155./256., 1
#:set background_color 62./256., 70./256., 81./256., 1
#:import NavigationDrawer uix.navigationdrawer.NavigationDrawer


<GridH@GridLayout>
    cols: 1
    padding: dp(20)
    spacing: dp(4)
    size_hint: 1, None
    height: self.minimum_height
    padding: [5,5,7,5]

<EventItemDetail@Popup>
    separator_color: active_text_color
    links: ''
    speaker_name: ''
    description: ''
    GridH:
        LeftAlignedLabel
            text: root.links
        LeftAlignedLabel
        LeftAlignedLabel
        LeftAlignedLabel


<LeftAlignedLabel@Label>
    padding: dp(12), dp(4)
    text_size: self.width, None
    size_hint_y: None
    height: self.texture_size[1]
    valign: 'middle'
    halign: 'left'
    canvas.before:
        Color:
            rgba: 0, 0, 0, .5
        Rectangle:
            texture: self.texture
            pos: self.x + dp(2), self.y - dp(2)
            size: self.size

<RightAlignedLabel@LeftAlignedLabel>
    halign: 'right'

<EventItem@TouchRippleBehavior+ButtonBehavior+GridH>
    spkr_detail: 'Dummy Speaker'
    title: 'Dummy Title'
    time: '9:00 - 10:00'
    orientation: 'vertical'
    padding: [0,4,0,4]
    canvas.before:
        Color:
            rgba: 39./256., 115./256., 90./256., .7
        Rectangle:
            pos: self.pos
            size: self.size
    RightAlignedLabel:
        markup: True
        text: '[color=rgb(255,244,139)]{}[/color]'.format(root.time)
        font_size: sp(10)
    LeftAlignedLabel:
        text: root.title
        font_size: sp(14)
    LeftAlignedLabel:
        markup: True
        text: '[color=rgb(255,244,139)]{}[/color]'.format(root.spkr_detail)
        font_size: sp(11)


<PyDelButton@TouchRippleBehavior+Button>
    default: False
    size_hint: 1, None
    height: dp(27)
    background_normal: 'data/but_{}.png'.format('light' if self.default else 'drk')
    background_down: 'data/but_{}.png'.format('drk' if self.default else 'light')


<ScreenSchedule@Screen>
    TabbedCarousel
        id: panel_schedule
        background_image: 'data/ig.jpg'
        Screen
            tab: tab_audi_3
            ScrollView
                GridH
                    id: grid_audi3
                    EventItem
                        spkr_detail: 'By Kiran Jonnalagadda'
                        title: 'KeyNote'
                        time: '10:00AM - 10:45AM'
                    EventItem
                        spkr_detail: 'Workshop by Prof. Kannan Moudgalya'
                        title: 'FOSSEE/Spoken Tutorial'
                        time: '10:45AM - 12:30PM'
                    EventItem
                        spkr_detail: 'Talk by Mayank Jain'
                        title: 'Real time web application using Django, Tornado and SockJS'
                        time: '12:30PM - 1:00PM'
                    EventItem
                        spkr_detail: 'Talk by Mohammad Asad Siddiqui'
                        title: 'Development of an academic cloud infrastructure at IIT Delhi'
                        time: '1:30PM - 2:00PM'
                    EventItem
                        spkr_detail: "Debabrata Nayak"
                        time: '2:15 - 2:45'
                    EventItem
                        spkr_detail: 'TBA'
                        title: 'Workshop'
                        time: '2:15PM - 4:00PM'
                    EventItem
                        spkr_detail: 'Talk by Arulalan T'
                        title: 'Advantages of Python in Atmospheric and Oceanic Sciences'
                        time: '4:00PM - 4:30PM'
                    EventItem
                        spkr_detail: 'Talk by Sridhar Rao'
                        title: 'Python in the SDN World'
                        time: '4:50PM - 5:20PM'
                    EventItem
                        spkr_detail: 'Assorted Speakers'
                        title: 'Ligntning Talks'
                        time: '5:20pm - 6:00pm'
        Screen
            tab: tab_lh1
            ScrollView
                GridH
                    id: grid_hall_1
                    EventItem
                        spkr_detail: 'Workshop by Suman Debnath'
                        title: 'Ansible and Vagrant'
                        time: '10:45AM - 12:30PM'
                    EventItem
                        spkr_detail: 'Talk by Jaidev Deshpande'
                        title: 'Automatic Data Validation and Cleaning with PySemantic'
                        time: '12:30PM - 1:00PM'
                    EventItem
                        spkr_detail: 'Talk by Peeyush Aggarwal'
                        title: 'Forget InstaGram. Make your own filters'
                        time: '1:30PM - 2:00PM'
                    EventItem
                        spkr_detail: 'Workshop by Rishabh Shukla'
                        title: 'Deep Learning in NLP - Powered by Python'
                        time: '2:15 PM - 4:00 PM'
                    EventItem
                        spkr_detail: 'Talk by Amit Singh Sethi'
                        title: 'Lettuce, Salad and How to write beautiful tests'
                        time: '4:00 PM - 4:30 PM'
                    EventItem
                        spkr_detail: 'Talk by Manoj Pandey'
                        title: 'An Introduction to Web Scraping using Python'
                        time: '4:50 PM - 5:20 PM'
                    EventItem
                        spkr_detail: ' '
                        title: 'Open Space'
                        time: '5:20pm - 6:00pm'
        Screen
            tab: tab_lh2
            ScrollView
                GridH
                    id: grid_hall_2
                    EventItem
                        spkr_detail: 'Workshop by Sanyam, Rishabh, Rajat & Anuvrat'
                        title: 'Mobile as Microbit teaching Python for beginners'
                        time: '10:45AM - 12:30PM'
                    EventItem
                        spkr_detail: 'Talk by Ashutosh Singh & Nupur Agrahari'
                        title: 'Python Byte elongating Battery Life'
                        time: '12:30PM - 1:00PM'
                    EventItem
                        spkr_detail: 'Talk by Abhinandan Kothari'
                        title: 'Functional Testing of Mobile Applications using Appium and Python'
                        time: '1:30PM - 2:00PM'
                    EventItem
                        spkr_detail: 'Workshop by Sandeep Nagar'
                        title: 'IoT with Python and Rasberry Pi'
                        time: '2:15 PM - 4:00 PM'
                    EventItem
                        spkr_detail: 'Talk by Dhruv Kalaan'
                        title: 'Fraud & Anomaly Detection Using ELK Stack, Kibana & Python Elast-Alert'
                        time: '4:00 PM - 4:30 PM'
                    EventItem
                        spkr_detail: 'Talk by Shantanu'
                        title: 'Extending Zulip for Inhouse Chat-With-Customer tool'
                        time: '4:50 PM - 5:20 PM'
                    EventItem
                        spkr_detail: ' '
                        title: 'Open Space'
                        time: '5:20pm - 6:00pm'
        CleanHeader
            id: tab_audi_3
            text: "Audi 3"
            slide: 0
        CleanHeader
            id: tab_lh1
            slide: 1
            text: "Lecture Hall 1"
        CleanHeader
            id: tab_lh2
            slide: 2
            text: "Lecture Hall 2"

<ScreenMaps@Screen>
    id: scr_maps
    text: 'Location'
    StencilView
        id: stencil_maps
        BoxLayout:
            size: stencil_maps.size
            pos: 0, 0
            orientation: 'vertical'
            Image:
                allow_stretch: True
                source: 'data/jnu_center.jpg'
                on_touch_down: 
                    if args[1].is_double_tap: Animation(center = sctr_space.center, rotation=0, scale = 1).start(sctr_map)
            RelativeLayout:
                id: sctr_space
                Scatter:
                    id: sctr_map
                    size_hint: None, None
                    size: sctr_space.size
                    Image:
                        id: map_img
                        size: sctr_space.size
                        pos: dp(0), dp(0)
                        allow_stretch: True
                        source: 'data/jnu.png'
                        on_touch_down:
                            if args[1].is_double_tap and self.collide_point(*args[1].pos): Animation(center = sctr_space.center, rotation=0, scale = 1 if sctr_map.scale >2 else 3).start(sctr_map)
        PyDelButton:
            text: 'Open Map'
            pos: stencil_maps.right - self.width - dp(10), dp(15)
            size: dp(100), dp(40)
            default: True
            on_release:
                webbrowser.open('https://www.google.co.in/maps/place/Convention+Center/@28.5418632,77.1636535,16z/data=!4m5!1m2!2m1!1sJNU+Convention+center!3m1!1s0x390d1ddb55725eaf:0xdf1d45bdd082aedf?hl=en')
        PyDelButton:
            text: 'Open Street view'
            pos: dp(15), dp(15)
            size: dp(200), dp(40)
            default: True
            on_release:
                webbrowser.open('https://www.google.co.in/maps/@28.53792,77.1662708,3a,75y,314.71h,71.28t/data=!3m6!1e1!3m4!1sk22VqhFqAcHHxi_gm9_M1w!2e0!7i13312!8i6656?hl=en')

<ScreenSponsors@Screen>
    id: tab_sponsors
    text: 'Sponsors'
    BoxLayout
        padding: dp(12)
        orientation: 'vertical'
        spacing: dp(4)
        Image
            source: 'data/fossee.png'
            allow_stretch: True
            size_hint: 1, .5
        GridLayout
            cols: 2
            rows: 2
            spacing: dp(4)
            #Image
            #Image
            #Image
            #Image
        PyDelButton
            text: 'Sponsor Us'
            default: True
            size_hint_y: None
            height: dp(40)
            on_release: webbrowser.open('https://conference.pydelhi.org/data/SponsorshipProspectus2016.pdf')
        PyDelButton
            text: 'Contact Us'
            size_hint_y: None
            height: dp(40)
            on_release: webbrowser.open('mailto:sponsorship@pydelhi.org')

<ScreenTickets@Screen>
    id: tickets
    text: 'Tickets'
    BoxLayout
        padding: dp(12)
        orientation: 'vertical'
        spacing:dp(5)
        Image:
            source: 'data/ticket.png'
            allow_stretch: True
            opacity: .1
        PyDelButton
            text: 'My tickets'
            size_hint_y: None
            height: dp(54)
            on_release:
                webbrowser.open('https://in.explara.com/a/account/manage/my-orders')
        PyDelButton
            default: True
            text: 'Buy tickets'
            size_hint_y: None
            height: dp(54)
            on_release:
                webbrowser.open('https://in.explara.com/e/pydelhi-conference/')

<ScreenAbout@Screen>
    id: tab_maps
    text: 'About'
    BoxLayout
        padding: dp(12)
        orientation: 'vertical'
        ScrollView
            spacing: dp(4)
            LeftAlignedLabel:
                padding: dp(12), dp(12)
                markup: True
                text: app.about_text
                on_ref_press: webbrowser.open('http://pydelhi.org')
        PyDelButton
            default: True
            text: 'History'
            size_hint:1, None
            height: dp(54)
            on_release:
                webbrowser.open('http://www.meetup.com/pydelhi/events/past/?scroll=true')

<ImageButton@ButtonBehavior+Image>
    opacity: .5 if self.state == 'down' else 1

<StripLayout>
    padding: 0, 0, 0, 0

<TabbedPanelStrip>:
    on_parent:
        if self.parent: self.parent.bar_width = 0
        if self.parent: self.parent.scroll_x = 0.5

<TabbedCarousel>
    carousel: carousel
    do_default_tab: False
    Carousel:
        scroll_timeout: 120
        scroll_distance: '20dp'
        anim_type: 'out_quart'
        min_move: .05
        anim_move_duration: .1
        anim_cancel_duration: .54
        on_index: root.on_index(*args)
        id: carousel

<CleanHeader@TabbedPanelHeader>
    border: 16, 0, 16, 0
    markup: False
    text_size: self.size
    halign: 'center'
    valign: 'middle'
    font_size: '13sp'
    background_normal: 'data/transparent.png'
    background_down: 'data/but_overlay.png'
    always_release: True

<NavigationItem@TouchRippleBehavior+Button>
    background_color: background_color if self.state == 'normal' else (1, 1, 1, 1)
    background_normal: ''
    background_down: 'data/but_overlay.png'
    size_hint_y: None
    height: dp(45)
    on_release:
        app.root.ids.screen_manager.current = self.text
        app.root.toggle_state()

###### Root widget starts here
######

NavigationDrawer
    id: navigationdrawer
    ScrollView
        canvas.before:
            Color:
                rgba: 47./255, 47./255., 47./255., 1
            Rectangle:
                size: self.size
                pos: self.pos
        GridH
            padding: dp(4)
            spacing: dp(4)
            Image: 
                size_hint_y: None
                height: dp(90)
                source: 'data/logo.png'
                allow_stretch: True
            NavigationItem:
                text: 'Schedule'
            NavigationItem:
                text: 'Location'
            NavigationItem:
                text: 'Sponsors'
            NavigationItem:
                text: 'Tickets'
            NavigationItem:
                text: 'About'

    BoxLayout:
        opacity: 1 - ((self.x+1)/dp(300))
        screen_manager: screen_manager
        canvas.before:
            Color:
                rgba: background_color 
            Rectangle:
                size: self.size
                pos: self.pos
        orientation: 'vertical'
        BoxLayout
            size_hint_y: None
            height: dp(54)
            canvas.before:
                Color: 
                    rgba: 1, 1, 1, .02
                Rectangle:
                    size: self.size
                    pos: self.pos
            ImageButton
                id: hamburger
                source: 'data/hamburger.png'
                size_hint: None, 1
                width:  self.height 
                on_release: navigationdrawer.toggle_state()
            ImageButton
                source: 'data/logo.png'
            Widget:
                size_hint_x: None
                width: hamburger.width
        ScreenManager
            id: screen_manager
            ScreenSchedule
                name: 'Schedule'
            ScreenMaps
                name: 'Location'
            ScreenSponsors
                name: 'Sponsors'
            ScreenTickets
                name: 'Tickets'
            ScreenAbout
                name: 'About'
                
                        